---

services:
  wg-easy:
    image: ghcr.io/wg-easy/wg-easy
    cpus: 0.5
    mem_limit: 200m
    container_name: wg-easy
    volumes:
      - ./wg-easy:/etc/wireguard
    networks:
      - {{ docker_vpn_network }}
    ports:
      - "${WG_PORT}:${WG_PORT}/udp"
    env_file:
      - .env
    cap_add:
      - NET_ADMIN
      - SYS_MODULE
    sysctls:
      - net.ipv4.ip_forward=1
      - net.ipv4.conf.all.src_valid_mark=1
    restart: unless-stopped

  wg-nginx:
    image: nginx:latest
    cpus: 0.5
    mem_limit: 200m
    container_name: wg-nginx
    hostname: ${DOMAIN}
    volumes:
      - ./nginx/servers/:/etc/nginx/servers/
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - {{ cert_location_root_path }}:/etc/letsencrypt:ro
    networks:
      - {{ docker_vpn_network }}
    ports:
      - "${PORT}:443/tcp"
    restart: unless-stopped

networks:
  {{ docker_vpn_network }}:
    external: true

volumes:
  etc_wireguard:
